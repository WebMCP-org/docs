---
title: 'Rails Integration'
description: 'Integrate WebMCP tools with Ruby on Rails. Use Stimulus controllers and Hotwire for AI-enabled interactions in your Rails applications.'
icon: 'gem'
---

## Overview

Ruby on Rails applications can integrate WebMCP through JavaScript on the frontend. This guide shows how to use Stimulus controllers (Rails' default JS framework) and Hotwire/Turbo patterns to register AI tools that interact with your Rails backend.

## How It Works

When you import `@mcp-b/global` in your JavaScript, your Rails app starts an **MCP server** on the client side:

1. **MCP server starts** - `navigator.modelContext` is initialized with `TabServerTransport`
2. **Tools are registered** - Your Stimulus controllers call `registerTool()` to expose functionality
3. **AI agents connect** - External agents use `TabClientTransport` to discover and call tools
4. **Tools call your backend** - Tool handlers make API requests to your Rails backend

## Prerequisites

<Steps>
  <Step title="Install WebMCP">
    **With importmap (Rails 7+):**
    ```bash
    bin/importmap pin @mcp-b/global
    ```

    **With npm/yarn:**
    ```bash
    npm install @mcp-b/global
    ```
  </Step>

  <Step title="Have Rails 7+ configured">
    This guide uses Rails 7+ patterns with Stimulus and Turbo
  </Step>
</Steps>

<Info>
  For schema validation, see [Schemas Guide](/concepts/schemas).
</Info>

<Info>
  **How AI agents call your tools**: AI agents use `TabClientTransport` to connect to your page and call `client.listTools()` to discover available tools, then `client.callTool()` to execute them. See [Transports](/packages/transports) for details.
</Info>

## Stimulus Controller

Create a Stimulus controller for tool registration:

```javascript "app/javascript/controllers/webmcp_controller.js"
import { Controller } from "@hotwired/stimulus"
import "@mcp-b/global"

export default class extends Controller {
  static values = { tools: Array }

  #registrations = []

  connect() {
    if (!('modelContext' in navigator)) return

    this.toolsValue.forEach(tool => {
      const reg = navigator.modelContext.registerTool({
        name: tool.name,
        description: tool.description,
        inputSchema: tool.inputSchema || { type: 'object', properties: {} },
        execute: async (args) => this.executeTool(tool.name, args)
      })
      this.#registrations.push(reg)
    })
  }

  disconnect() {
    this.#registrations.forEach(r => r.unregister())
    this.#registrations = []
  }

  async executeTool(name, args) {
    const response = await fetch(`/api/tools/${name}`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-CSRF-Token': document.querySelector('meta[name="csrf-token"]').content
      },
      body: JSON.stringify(args)
    })
    const result = await response.json()
    return { content: [{ type: 'text', text: JSON.stringify(result) }] }
  }
}
```

### Usage in Views

```erb
<%# app/views/products/index.html.erb %>
<div data-controller="webmcp"
     data-webmcp-tools-value='<%= [
       {
         name: "search_products",
         description: "Search for products by name",
         inputSchema: {
           type: "object",
           properties: { query: { type: "string" } },
           required: ["query"]
         }
       }
     ].to_json %>'>
  <%= render @products %>
</div>
```

## Feature-Specific Controllers

Create dedicated controllers for specific functionality:

```javascript "app/javascript/controllers/cart_tools_controller.js"
import { Controller } from "@hotwired/stimulus"
import "@mcp-b/global"

export default class extends Controller {
  static targets = ["count"]

  #registrations = []

  connect() {
    if (!('modelContext' in navigator)) return

    this.#registrations.push(
      navigator.modelContext.registerTool({
        name: 'add_to_cart',
        description: 'Add a product to the cart',
        inputSchema: {
          type: 'object',
          properties: {
            productId: { type: 'string' },
            quantity: { type: 'number' }
          },
          required: ['productId']
        },
        execute: async (args) => this.addToCart(args.productId, args.quantity || 1)
      })
    )
  }

  disconnect() {
    this.#registrations.forEach(r => r.unregister())
  }

  async addToCart(productId, quantity) {
    const response = await fetch('/cart/items', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-CSRF-Token': document.querySelector('meta[name="csrf-token"]').content
      },
      body: JSON.stringify({ product_id: productId, quantity })
    })
    const result = await response.json()

    if (this.hasCountTarget) {
      this.countTarget.textContent = result.total_items
    }

    return { content: [{ type: 'text', text: JSON.stringify(result) }] }
  }
}
```

## Rails API Endpoints

Create API endpoints for tools:

```ruby
# app/controllers/api/tools_controller.rb
class Api::ToolsController < ApplicationController
  def execute
    result = case params[:tool_name]
    when 'search_products'
      { results: Product.search(params[:query]).limit(10).as_json }
    when 'add_to_cart'
      item = current_cart.add_item(params[:product_id], params[:quantity].to_i)
      { success: true, total_items: current_cart.item_count }
    else
      { error: 'Unknown tool' }
    end

    render json: result
  end
end
```

```ruby
# config/routes.rb
Rails.application.routes.draw do
  namespace :api do
    post 'tools/:tool_name', to: 'tools#execute'
  end
end
```

## Turbo Integration

Combine with Turbo Frames:

```javascript "app/javascript/controllers/turbo_tools_controller.js"
import { Controller } from "@hotwired/stimulus"
import "@mcp-b/global"

export default class extends Controller {
  static values = { frameId: String }

  #registration = null

  connect() {
    if (!('modelContext' in navigator)) return

    this.#registration = navigator.modelContext.registerTool({
      name: 'refresh_content',
      description: 'Refresh this section',
      inputSchema: { type: 'object', properties: {} },
      execute: async () => {
        document.getElementById(this.frameIdValue)?.reload()
        return { content: [{ type: 'text', text: 'Refreshed' }] }
      }
    })
  }

  disconnect() {
    this.#registration?.unregister()
  }
}
```

## Global Tools

Place on `<body>` for app-wide tools:

```erb
<%# app/views/layouts/application.html.erb %>
<body data-controller="app-tools">
  <%= yield %>
</body>
```

```javascript "app/javascript/controllers/app_tools_controller.js"
import { Controller } from "@hotwired/stimulus"
import "@mcp-b/global"

export default class extends Controller {
  #registrations = []

  connect() {
    if (!('modelContext' in navigator)) return

    this.#registrations.push(
      navigator.modelContext.registerTool({
        name: 'navigate',
        description: 'Navigate to a page',
        inputSchema: {
          type: 'object',
          properties: { path: { type: 'string' } },
          required: ['path']
        },
        execute: async (args) => {
          Turbo.visit(args.path)
          return { content: [{ type: 'text', text: `Navigating to ${args.path}` }] }
        }
      })
    )
  }

  disconnect() {
    this.#registrations.forEach(r => r.unregister())
  }
}
```

## Common Gotchas

<AccordionGroup>
  <Accordion title="CSRF token issues">
    Always include the CSRF token in requests:

    ```javascript
    headers: {
      'X-CSRF-Token': document.querySelector('meta[name="csrf-token"]').content
    }
    ```
  </Accordion>

  <Accordion title="Tools not registering after Turbo navigation">
    Place the controller on `<body>` so it persists across navigations, or use:

    ```javascript
    document.addEventListener('turbo:load', () => {
      // Re-register if needed
    })
    ```
  </Accordion>

  <Accordion title="importmap not finding @mcp-b/global">
    Pin the package:

    ```bash
    bin/importmap pin @mcp-b/global
    ```
  </Accordion>
</AccordionGroup>

## Resources

<CardGroup cols={2}>
  <Card title="Rails Guides" icon="book" href="https://guides.rubyonrails.org/">
    Official Ruby on Rails documentation
  </Card>

  <Card title="Stimulus Handbook" icon="bolt" href="https://stimulus.hotwired.dev/handbook/introduction">
    Official Stimulus documentation
  </Card>

  <Card title="Transports" icon="plug" href="/packages/transports">
    TabClientTransport and TabServerTransport reference
  </Card>

  <Card title="AI Frameworks" icon="sparkles" href="/ai-frameworks">
    Integrate with Assistant-UI, AG-UI, or custom runtimes
  </Card>
</CardGroup>
