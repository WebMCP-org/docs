---
title: 'Rails Integration'
description: 'Integrate WebMCP tools with Ruby on Rails using Stimulus controllers.'
icon: 'gem'
---

<Info>
**Prerequisites**: For the full API, see [Global Package](/packages/global) and [Tool Registration](/concepts/tool-registration).
</Info>

## Installation

**With importmap (Rails 7+):**
```bash
bin/importmap pin @mcp-b/global
```

**With npm/yarn:**
```bash
npm install @mcp-b/global
```

## Basic Stimulus Controller

```javascript "app/javascript/controllers/webmcp_controller.js"
import { Controller } from "@hotwired/stimulus"
import "@mcp-b/global"

export default class extends Controller {
  static values = { name: String, description: String }

  #registration = null

  connect() {
    if (!('modelContext' in navigator)) return

    this.#registration = navigator.modelContext.registerTool({
      name: this.nameValue,
      description: this.descriptionValue,
      inputSchema: { type: 'object', properties: {} },
      execute: async () => {
        return { content: [{ type: 'text', text: 'Done' }] }
      }
    })
  }

  disconnect() {
    this.#registration?.unregister()
  }
}
```

```erb
<div data-controller="webmcp"
     data-webmcp-name-value="my_tool"
     data-webmcp-description-value="My tool description">
  Content
</div>
```

## With Backend API

```javascript "app/javascript/controllers/cart_controller.js"
import { Controller } from "@hotwired/stimulus"
import "@mcp-b/global"

export default class extends Controller {
  #registration = null

  connect() {
    if (!('modelContext' in navigator)) return

    this.#registration = navigator.modelContext.registerTool({
      name: 'add_to_cart',
      description: 'Add a product to the cart',
      inputSchema: {
        type: 'object',
        properties: {
          productId: { type: 'string' },
          quantity: { type: 'number' }
        },
        required: ['productId']
      },
      execute: async ({ productId, quantity = 1 }) => {
        const response = await fetch('/cart/items', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'X-CSRF-Token': document.querySelector('meta[name="csrf-token"]').content
          },
          body: JSON.stringify({ product_id: productId, quantity })
        })
        const result = await response.json()
        return { content: [{ type: 'text', text: JSON.stringify(result) }] }
      }
    })
  }

  disconnect() {
    this.#registration?.unregister()
  }
}
```

## Global Tools

Attach to `<body>` for persistence across Turbo navigations:

```erb
<%# app/views/layouts/application.html.erb %>
<body data-controller="global-tools">
  <%= yield %>
</body>
```

```javascript "app/javascript/controllers/global_tools_controller.js"
import { Controller } from "@hotwired/stimulus"
import "@mcp-b/global"

export default class extends Controller {
  #registration = null

  connect() {
    if (!('modelContext' in navigator)) return

    this.#registration = navigator.modelContext.registerTool({
      name: 'navigate',
      description: 'Navigate to a page',
      inputSchema: {
        type: 'object',
        properties: { path: { type: 'string' } },
        required: ['path']
      },
      execute: async ({ path }) => {
        Turbo.visit(path)
        return { content: [{ type: 'text', text: `Navigating to ${path}` }] }
      }
    })
  }

  disconnect() {
    this.#registration?.unregister()
  }
}
```

## Common Gotchas

<AccordionGroup>
  <Accordion title="CSRF token issues">
    Include the CSRF token in requests:
    ```javascript
    headers: {
      'X-CSRF-Token': document.querySelector('meta[name="csrf-token"]').content
    }
    ```
  </Accordion>

  <Accordion title="Tools not registering after Turbo navigation">
    Place controllers on `<body>` so they persist, or use `turbo:load` event:
    ```javascript
    document.addEventListener('turbo:load', () => {
      // Re-register if needed
    })
    ```
  </Accordion>

  <Accordion title="importmap not finding @mcp-b/global">
    Pin the package:
    ```bash
    bin/importmap pin @mcp-b/global
    ```
  </Accordion>
</AccordionGroup>
